set(CMAKE_BINARY_INSTALL_ROOT "@CMAKE_BINARY_INSTALL_ROOT@")
execute_process(COMMAND "${CMAKE_COMMAND}" -E echo "Scanning ${CMAKE_BINARY_INSTALL_ROOT}...")

file(GLOB_RECURSE EXTINSTALL_LIB_FILES LIST_DIRECTORIES false "${CMAKE_BINARY_INSTALL_ROOT}/lib/*")
file(GLOB_RECURSE EXTINSTALL_BIN_FILES LIST_DIRECTORIES false "${CMAKE_BINARY_INSTALL_ROOT}/bin/*")
set(EXTINSTALL_FILES ${EXTINSTALL_LIB_FILES} ${EXTINSTALL_BIN_FILES})
foreach(lf ${EXTINSTALL_FILES})
  execute_process(COMMAND patchelf ${lf} RESULT_VARIABLE NOT_BIN_OBJ OUTPUT_VARIABLE NB_OUT ERROR_VARIABLE NB_ERR)
  if (NOT_BIN_OBJ)
    continue()
  endif (NOT_BIN_OBJ)
  set(B_FILES ${B_FILES} ${lf})
endforeach(lf ${EXTINSTALL_FILES})
foreach(lf ${B_FILES})
  message("${lf}")
  execute_process(COMMAND patchelf --remove-rpath ${lf})
  execute_process(COMMAND patchelf --set-rpath "${CMAKE_BINARY_INSTALL_ROOT}/lib" ${lf})
endforeach(lf ${B_FILES})

# Local Variables:
# tab-width: 8
# mode: cmake
# indent-tabs-mode: t
# End:
# ex: shiftwidth=2 tabstop=8
